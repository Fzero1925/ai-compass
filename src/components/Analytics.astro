---
// Analytics Integration Component
// Supports Google Analytics and other tracking services

const GOOGLE_ANALYTICS_ID = import.meta.env.PUBLIC_GOOGLE_ANALYTICS_ID;
const isDev = import.meta.env.DEV;

// Only load analytics in production
const shouldLoadAnalytics = !isDev && GOOGLE_ANALYTICS_ID;
---

{shouldLoadAnalytics && (
  <Fragment>
    <!-- Google Analytics -->
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${GOOGLE_ANALYTICS_ID}`}></script>
    <script is:inline define:vars={{GOOGLE_ANALYTICS_ID}}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', GOOGLE_ANALYTICS_ID, {
        page_title: document.title,
        page_location: window.location.href,
        cookie_flags: 'secure;samesite=none'
      });
      
      // Custom events for article interactions
      window.trackArticleView = function(articleTitle, category) {
        gtag('event', 'article_view', {
          'article_title': articleTitle,
          'article_category': category,
          'page_title': document.title,
          'page_location': window.location.href
        });
      };
      
      window.trackSearchQuery = function(query, resultsCount) {
        gtag('event', 'search', {
          'search_term': query,
          'search_results': resultsCount
        });
      };
      
      window.trackCategoryView = function(category) {
        gtag('event', 'category_view', {
          'category_name': category,
          'page_location': window.location.href
        });
      };
      
      window.trackOutboundClick = function(url, linkText) {
        gtag('event', 'click', {
          'event_category': 'outbound',
          'event_label': url,
          'link_text': linkText
        });
      };
    </script>
  </Fragment>
)}

{isDev && (
  <!-- Development Mode: Analytics Disabled -->
  <script is:inline>
    console.log('ðŸ“Š Analytics disabled in development mode');
    
    // Mock analytics functions for development
    window.trackArticleView = function(articleTitle, category) {
      console.log('ðŸ“Š [DEV] Article view:', articleTitle, category);
    };
    
    window.trackSearchQuery = function(query, resultsCount) {
      console.log('ðŸ“Š [DEV] Search:', query, resultsCount, 'results');
    };
    
    window.trackCategoryView = function(category) {
      console.log('ðŸ“Š [DEV] Category view:', category);
    };
    
    window.trackOutboundClick = function(url, linkText) {
      console.log('ðŸ“Š [DEV] Outbound click:', url, linkText);
    };
  </script>
)}