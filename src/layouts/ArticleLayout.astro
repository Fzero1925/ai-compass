---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StructuredData from '../components/StructuredData.astro';
import { articleCategories, type Article } from '../data/articles';

export interface Props extends Article {}

const { slug, title, description, category, publishDate, author, tags, readTime, image } = Astro.props;

const categoryInfo = articleCategories[category];
const formattedDate = new Date(publishDate).toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: 'long', 
  day: 'numeric'
});

const pageTitle = `${title} - AI Compass`;
const pageUrl = `https://fzero1925.github.io/ai-compass/articles/${slug}/`;
---

<BaseLayout title={pageTitle} description={description} image={image} url={pageUrl}>
  <Header />
  
  <main>
    <!-- Breadcrumb -->
    <section class="bg-gray-50 py-4">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <nav class="flex items-center space-x-2 text-sm text-gray-600">
          <a href="/" class="hover:text-primary-600 transition-colors">首页</a>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
          <a href="/articles" class="hover:text-primary-600 transition-colors">文章</a>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
          <a href={`/articles/category/${category}`} class="hover:text-primary-600 transition-colors">{categoryInfo.name}</a>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
          <span class="text-gray-900 font-medium">{title.length > 50 ? title.substring(0, 50) + '...' : title}</span>
        </nav>
      </div>
    </section>

    <!-- Article Header -->
    <section class="py-12">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <!-- Category Badge -->
        <div class="flex items-center gap-2 mb-4">
          <span class={`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-gradient-to-r ${categoryInfo.color} text-white`}>
            <span class="text-lg">{categoryInfo.icon}</span>
            {categoryInfo.name}
          </span>
        </div>
        
        <!-- Title -->
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-6 leading-tight">
          {title}
        </h1>
        
        <!-- Meta Info -->
        <div class="flex flex-wrap items-center gap-6 text-gray-600 mb-8">
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span>{author}</span>
          </div>
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span>{formattedDate}</span>
          </div>
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>{readTime}分钟阅读</span>
          </div>
        </div>
        
        <!-- Description -->
        <p class="text-xl text-gray-600 mb-8 leading-relaxed">
          {description}
        </p>
        
        <!-- Tags -->
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-8">
            {tags.map(tag => (
              <span class="inline-block px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm rounded-full cursor-pointer transition-colors">
                #{tag}
              </span>
            ))}
          </div>
        )}
        
        <!-- Feature Image -->
        {image && (
          <div class="mb-8">
            <img 
              src={image} 
              alt={title}
              class="w-full h-64 sm:h-80 object-cover rounded-xl shadow-lg"
              loading="lazy"
            />
          </div>
        )}
      </div>
    </section>

    <!-- Article Content -->
    <section class="pb-12">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <div class="prose prose-lg prose-gray max-w-none">
          <slot />
        </div>
      </div>
    </section>

    <!-- Social Share -->
    <section class="border-t border-gray-200 py-8">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">分享这篇文章</h3>
            <p class="text-gray-600 text-sm">觉得有用？分享给你的朋友们</p>
          </div>
          <div class="flex items-center space-x-4">
            <button 
              onclick="shareToWechat()"
              class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors"
            >
              分享到微信
            </button>
            <button 
              onclick="shareToWeibo()"
              class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors"
            >
              分享到微博
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
  
  <!-- Structured Data for Article -->
  <StructuredData 
    type="article" 
    data={{
      headline: title,
      description: description,
      author: {
        "@type": "Organization",
        name: author
      },
      datePublished: publishDate,
      dateModified: publishDate,
      image: image ? `https://fzero1925.github.io/ai-compass${image}` : undefined,
      publisher: {
        "@type": "Organization", 
        name: "AI Compass",
        logo: {
          "@type": "ImageObject",
          url: "https://fzero1925.github.io/ai-compass/favicon.svg"
        }
      },
      mainEntityOfPage: {
        "@type": "WebPage",
        "@id": pageUrl
      },
      keywords: tags.join(", "),
      articleSection: categoryInfo.name,
      wordCount: description.length * 10 // 估算字数
    }} 
  />
</BaseLayout>

<script>
  function shareToWechat() {
    // 微信分享逻辑
    navigator.clipboard.writeText(window.location.href).then(() => {
      alert('链接已复制到剪贴板，可以直接粘贴分享');
    });
  }
  
  function shareToWeibo() {
    const title = document.querySelector('h1')?.textContent || '';
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(`${title} - AI Compass专业评测`);
    window.open(`https://service.weibo.com/share/share.php?url=${url}&title=${text}`, '_blank');
  }
  
  // Track article view when page loads
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof window.trackArticleView === 'function') {
      window.trackArticleView('${title}', '${category}');
    }
  });
</script>

<style>
  .prose {
    @apply text-gray-800;
  }
  
  .prose h2 {
    @apply text-2xl font-bold text-gray-900 mt-12 mb-6 border-l-4 border-primary-500 pl-4;
  }
  
  .prose h3 {
    @apply text-xl font-semibold text-gray-900 mt-8 mb-4;
  }
  
  .prose h4 {
    @apply text-lg font-medium text-gray-900 mt-6 mb-3;
  }
  
  .prose p {
    @apply mb-6 leading-relaxed;
  }
  
  .prose ul {
    @apply my-6 space-y-2;
  }
  
  .prose li {
    @apply leading-relaxed;
  }
  
  .prose blockquote {
    @apply border-l-4 border-primary-300 bg-primary-50 pl-6 py-4 my-8 italic;
  }
  
  .prose code {
    @apply bg-gray-100 px-2 py-1 rounded text-sm font-mono;
  }
  
  .prose pre {
    @apply bg-gray-900 text-gray-100 p-6 rounded-xl overflow-x-auto my-8;
  }
  
  .prose img {
    @apply rounded-lg shadow-md mx-auto;
  }
  
  .prose table {
    @apply w-full border-collapse border border-gray-300 my-8;
  }
  
  .prose th,
  .prose td {
    @apply border border-gray-300 px-4 py-2 text-left;
  }
  
  .prose th {
    @apply bg-gray-50 font-semibold;
  }
</style>